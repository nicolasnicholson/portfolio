---
import experience from "./experience.json";
import UrlLink from "./icons/UrlLink.astro";

function formatDate(dateStr) {
  if (!dateStr) return null;
  const date = new Date(dateStr);
  return date.toLocaleDateString('es-ES', { year: 'numeric', month: 'short' });
}

function timeSince(dateStr) {
  const start = new Date(dateStr);
  const now = new Date();
  let years = now.getFullYear() - start.getFullYear();
  let months = now.getMonth() - start.getMonth();
  let days = now.getDate() - start.getDate();
  if (days < 0) {
    months--;
    days += new Date(now.getFullYear(), now.getMonth(), 0).getDate();
  }
  if (months < 0) {
    years--;
    months += 12;
  }
  let result = "Hace ";
  if (years > 0) result += years + (years === 1 ? " año " : " años ");
  if (months > 0) result += months + (months === 1 ? " mes " : " meses ");
  if (years === 0 && months === 0) result += days + (days === 1 ? " día" : " días");
  return result.trim();
}
---

<section id="cases" class="sm:p-15 px-15 py-10">
  <h2 class="font-bold text-start text-4xl sm:text-5xl py-20">expe<span class="border-b-6 border-black pb-0.5">rience</span></h2>
  <div class="flex justify-center">
    <ol class="relative border-s-4 border-black/20 px-10 py-4 max-w-2xl">
      {experience.map(exp => (
        <li class="mb-16 ms-6">
          <span class="absolute -start-3 flex items-center justify-center w-6 h-6 bg-black rounded-full ring-4 ring-white"></span>
          <h3 class="font-bold text-2xl">{exp.title}</h3>
          {exp.company === null ? (
            <h3 class="text-lg text-gray-400 italic">Sin compañía</h3>
          ) : (exp.company.link ? (
            <a href={exp.company.link} target="_blank" class="text-lg font-semibold flex gap-2" style={`color: ${exp.company.color ? exp.company.color : '#2563eb'}`}>{exp.company.name} <UrlLink /></a>
          ) : (
            <h3 class="text-lg text-gray-700">{exp.company.name}</h3>
          ))}
          <span class="block text-sm text-gray-500 mb-2">
            {formatDate(exp.start)} - {exp.end ? formatDate(exp.end) : "Actualidad"}
            {!exp.end && (
              <span class="ml-2 text-gray-900">{timeSince(exp.start)}</span>
            )}
          </span>
          <ul class="list-disc pl-5 mb-2">
            {exp.characteristics.map(carac => (
              <li class="text-lg text-gray-700">{carac}</li>
            ))}
          </ul>
        </li>
      ))}
    </ol>
  </div>
</section>